(function(c){var g={lang:"en",resultTpl:'<div class="voog-search-result"><h3 class="voog-search-result-title"><a class="voog-search-result-link" href="[[url]]">[[title]]</a></h3><p class="voog-search-result-content">[[content]]</p></div>',modalTpl:'<div class="voog-search-container"><div class="voog-search-inner"><div class="voog-search-results"></div><div class="voog-search-noresults"></div><div class="voog-search-loader"></div></div></div>',noResults:"No results found!",minChars:3,$parent:c("body"),
closeOnSideClick:true},f=function(a,b){this.$el=a;this.options=c.extend({},g,b);this.init()};f.prototype={init:function(){this.$input=this.$el.find('input[type="search"], input[type="text"]');this.$modal=this.createModal();this.$content=this.$modal.find(".voog-search-inner");this.$loader=this.$modal.find(".voog-search-loader");this.$results=this.$modal.find(".voog-search-results");this.$noresults=this.$modal.find(".voog-search-noresults");this.$clearbtn=this.$el.find(".js-search-close");this.searcher=
new VoogSearchSDK(this.filterParams(this.options),c.proxy(this.handleSearchResult,this));this.$el.on("submit",c.proxy(this.handleSubmit,this));this.$input.on("keyup",c.proxy(this.handleInputKeyup,this));this.$input.on("focus",c.proxy(this.handleInputFocus,this));this.$input.on("blur",c.proxy(this.handleInputBlur,this));this.$clearbtn.on("click",c.proxy(this.handleClearButtonClick,this));this.$content.on("scroll",c.proxy(this.handleModalScroll,this))},createModal:function(){var a=c(this.options.modalTpl);
a.appendTo(this.options.$parent);return a},filterParams:function(a){for(var b=["per_page","page","lang","q","types","tags","path","tag_facets"],d={},e=b.length;e--;)if(typeof a[b[e]]!=="undefined")d[b[e]]=a[b[e]];return d},handleSubmit:function(a){a.preventDefault();a=this.$input.data("oldValue")||"";var b=this.$input.val();if(b!=a&&b.length>=this.options.minChars){this.$input.data("oldValue",b);this.doSearch()}return false},handleInputKeyup:function(){if(this.options.searchOnType){var a=this.$input.data("oldValue")||
"",b=this.$input.val();if(b!=a&&b.length>=this.options.minChars){this.$input.data("oldValue",b);this.doSearch()}}},handleInputFocus:function(){this.$el.find(".search-box").addClass("search-box-focus")},handleInputBlur:function(){var a=this.options.visibleClass?this.options.visibleClass:"voog-search-visible";c("body").hasClass(a)||this.$el.find(".search-box").removeClass("search-box-focus")},handleSideClick:function(a){!c.contains(this.$modal.get(0),a.target)&&a.target!==this.$modal.get(0)&&a.target!==
this.$input.get(0)&&this.reset()},handleClearButtonClick:function(a){a.preventDefault();this.reset()},handleModalScroll:function(){var a=this.$content.scrollTop();maxy=this.$content.get(0).scrollHeight-this.$content.get(0).offsetHeight;treshold=10;a>=maxy-10&&!this.loading_active&&this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()},doSearch:function(){clearTimeout(this.timeout);this.timeout=setTimeout(c.proxy(function(){var a=true,b=this.$input.val(),d=this.options.visibleClass?
this.options.visibleClass:"voog-search-visible";if(!c("body").hasClass(d)){c("body").addClass(d);if(this.options.closeOnSideClick)c(document).on("click.voog-search-sideclick",c.proxy(this.handleSideClick,this));a=true}this.setLoader(a);this.loading_active=true;this.searcher.query({q:b})},this),400)},setLoader:function(a){this.$results.empty().hide();this.$noresults.removeClass("voog-search-noresults-visible");a&&this.$loader.show()},unsetLoader:function(){this.$loader.hide()},hideSearch:function(){var a=
this.options.visibleClass?this.options.visibleClass:"voog-search-visible";c("body").removeClass(a);this.$el.find(".search-box").removeClass("search-box-focus");c(document).off("click.voog-search-sideclick")},reset:function(){this.$input.data("oldValue","").val("");this.hideSearch()},handleSearchResult:function(a){this.loading_active=false;this.pageLinks=a.pages;this.renderContent(a.result);this.unsetLoader();this.testScroll()},renderContent:function(a){if(a.length){this.$results.show();for(var b=
0,d=a.length;b<d;b++){var e=this.options.resultTpl.replace(/\[\[url\]\]/g,a[b].path).replace(/\[\[title\]\]/g,a[b].title).replace(/\[\[content\]\]/g,a[b].description);this.$results.append(c(e))}}else this.$noresults.addClass("voog-search-noresults-visible").empty().append("<div>"+this.options.noResults+"</div>").show()},fetchNextPage:function(){this.loading_active=true;this.pageLinks.next()},testScroll:function(){this.$content.get(0).offsetHeight===this.$content.get(0).scrollHeight&&!this.loading_active&&
this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()}};window.VoogSearch=f})(jQuery);
