!function(t){var s={lang:"en",resultTpl:'<div class="voog-search-result"><h3 class="voog-search-result-title"><a class="voog-search-result-link" href="[[url]]">[[title]]</a></h3><p class="voog-search-result-content">[[content]]</p></div>',modalTpl:'<div class="voog-search-container"><div class="voog-search-inner"><div class="voog-search-results"></div><div class="voog-search-noresults"></div><div class="voog-search-loader"></div></div></div>',noResults:"No results found!",minChars:3,$parent:t("body"),closeOnSideClick:!0},e=function(e,i){this.$el=e,this.options=t.extend({},s,i),this.init()};e.prototype={init:function(){this.$input=this.$el.find('input[type="search"], input[type="text"]'),this.$modal=this.createModal(),this.$content=this.$modal.find(".voog-search-inner"),this.$loader=this.$modal.find(".voog-search-loader"),this.$results=this.$modal.find(".voog-search-results"),this.$noresults=this.$modal.find(".voog-search-noresults"),this.$clearbtn=this.$el.find(".js-search-close"),this.searcher=new VoogSearchSDK(this.filterParams(this.options),t.proxy(this.handleSearchResult,this)),this.$el.on("submit",t.proxy(this.handleSubmit,this)),this.$input.on("keyup",t.proxy(this.handleInputKeyup,this)),this.$input.on("focus",t.proxy(this.handleInputFocus,this)),this.$input.on("blur",t.proxy(this.handleInputBlur,this)),this.$clearbtn.on("click",t.proxy(this.handleClearButtonClick,this)),this.$content.on("scroll",t.proxy(this.handleModalScroll,this))},createModal:function(){var s=t(this.options.modalTpl);return s.appendTo(this.options.$parent),s},filterParams:function(t){for(var s=["per_page","page","lang","q","types","tags","path","tag_facets"],e={},i=s.length;i--;)void 0!==t[s[i]]&&(e[s[i]]=t[s[i]]);return e},handleSubmit:function(t){t.preventDefault();var s=this.$input.data("oldValue")||"",e=this.$input.val();return e!=s&&e.length>=this.options.minChars&&(this.$input.data("oldValue",e),this.doSearch()),!1},handleInputKeyup:function(t){if(this.options.searchOnType){var s=this.$input.data("oldValue")||"",e=this.$input.val();e!=s&&e.length>=this.options.minChars&&(this.$input.data("oldValue",e),this.doSearch())}},handleInputFocus:function(){this.$el.find(".search-box").addClass("search-box-focus")},handleInputBlur:function(){var s=this.options.visibleClass?this.options.visibleClass:"voog-search-visible";t("body").hasClass(s)||this.$el.find(".search-box").removeClass("search-box-focus")},handleSideClick:function(s){t.contains(this.$modal.get(0),s.target)||s.target===this.$modal.get(0)||s.target===this.$input.get(0)||this.reset()},handleClearButtonClick:function(t){t.preventDefault(),this.reset()},handleModalScroll:function(t){var s=this.$content.scrollTop();maxy=this.$content.get(0).scrollHeight-this.$content.get(0).offsetHeight,treshold=10,s>=maxy-10&&!this.loading_active&&this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()},doSearch:function(){clearTimeout(this.timeout),this.timeout=setTimeout(t.proxy(function(){var s=!0,e=this.$input.val(),i=this.options.visibleClass?this.options.visibleClass:"voog-search-visible";t("body").hasClass(i)||(t("body").addClass(i),this.options.closeOnSideClick&&t(document).on("click.voog-search-sideclick",t.proxy(this.handleSideClick,this)),s=!0),this.setLoader(s),this.loading_active=!0,this.searcher.query({q:e})},this),400)},setLoader:function(t){this.$results.empty().hide(),this.$noresults.removeClass("voog-search-noresults-visible"),t&&this.$loader.show()},unsetLoader:function(){this.$loader.hide()},hideSearch:function(){var s=this.options.visibleClass?this.options.visibleClass:"voog-search-visible";t("body").removeClass(s),this.$el.find(".search-box").removeClass("search-box-focus"),t(document).off("click.voog-search-sideclick")},reset:function(){this.$input.data("oldValue","").val(""),this.hideSearch()},handleSearchResult:function(t){this.loading_active=!1,this.pageLinks=t.pages,this.renderContent(t.result),this.unsetLoader(),this.testScroll()},renderContent:function(s){if(s.length){this.$results.show();for(var e=0,i=s.length;e<i;e++){var o=this.options.resultTpl.replace(/\[\[url\]\]/g,s[e].path).replace(/\[\[title\]\]/g,s[e].title).replace(/\[\[content\]\]/g,s[e].description);this.$results.append(t(o))}}else this.$noresults.addClass("voog-search-noresults-visible").empty().append("<div>"+this.options.noResults+"</div>").show()},fetchNextPage:function(){this.loading_active=!0,this.pageLinks.next()},testScroll:function(){this.$content.get(0).offsetHeight===this.$content.get(0).scrollHeight&&!this.loading_active&&this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()}},window.VoogSearch=e}(jQuery);